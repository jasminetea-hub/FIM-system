# R FastAPIç’°å¢ƒæ§‹ç¯‰ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

FastAPIã§Rã®äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã®ç’°å¢ƒæ§‹ç¯‰æ‰‹é †ã§ã™ã€‚

## å¿…è¦ãªç’°å¢ƒ

- **Python**: 3.8ä»¥ä¸Š
- **R**: 4.0ä»¥ä¸Š
- **OS**: Windows / macOS / Linux

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Windowsç’°å¢ƒ

#### 1. Rã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

1. [CRAN](https://cran.r-project.org/)ã‹ã‚‰Rã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè¡Œã—ã¦Rã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèªï¼ˆé€šå¸¸ã¯ `C:\Program Files\R\R-x.x.x`ï¼‰

#### 2. Rtoolsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆrpy2ã«å¿…è¦ï¼‰

1. [Rtools](https://cran.r-project.org/bin/windows/Rtools/)ã‹ã‚‰Rtoolsã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
2. ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å®Ÿè¡Œ
3. ç’°å¢ƒå¤‰æ•° `PATH` ã«Rtoolsã®binãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ 
   - ä¾‹: `C:\rtools43\usr\bin`

#### 3. Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Rã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¾ãŸã¯RStudioã§å®Ÿè¡Œï¼š

```r
source("r_api/install_r_packages.R")
```

ã¾ãŸã¯æ‰‹å‹•ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š

```r
install.packages(c("tidyverse", "caret", "randomForest"))
```

#### 4. Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd r_api
setup.bat
```

ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ï¼š
- Pythonä»®æƒ³ç’°å¢ƒã®ä½œæˆ
- ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- ãƒ¢ãƒ‡ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

### macOSç’°å¢ƒ

#### 1. Rã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Homebrewã‚’ä½¿ç”¨
brew install r

# ã¾ãŸã¯å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
# https://cran.r-project.org/bin/macosx/
```

#### 2. Xcode Command Line Toolsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
xcode-select --install
```

#### 3. Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Rã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œï¼š

```r
source("r_api/install_r_packages.R")
```

#### 4. Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd r_api
chmod +x setup.sh
./setup.sh
```

### Linuxç’°å¢ƒï¼ˆUbuntu/Debianï¼‰

#### 1. Rã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install r-base r-base-dev

# ã¾ãŸã¯æœ€æ–°ç‰ˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt-get install software-properties-common
sudo add-apt-repository "deb https://cloud.r-project.org/bin/linux/ubuntu $(lsb_release -cs)-cran40/"
sudo apt-get update
sudo apt-get install r-base
```

#### 2. Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
sudo R
```

Rã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œï¼š

```r
source("r_api/install_r_packages.R")
```

#### 3. Pythonç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd r_api
chmod +x setup.sh
./setup.sh
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### rpy2ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼

#### Windows

1. RãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªï¼š
   ```cmd
   where R
   ```

2. R_HOMEç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼š
   ```cmd
   setx R_HOME "C:\Program Files\R\R-4.3.2"
   ```

3. RtoolsãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

#### macOS/Linux

1. Rã®ãƒ‘ã‚¹ã‚’ç¢ºèªï¼š
   ```bash
   which R
   R --version
   ```

2. R_HOMEç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼š
   ```bash
   export R_HOME=$(R RHOME)
   echo 'export R_HOME=$(R RHOME)' >> ~/.bashrc
   ```

3. rpy2ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š
   ```bash
   pip uninstall rpy2
   pip install rpy2
   ```

### Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼

```r
# CRANãƒŸãƒ©ãƒ¼ã‚’å¤‰æ›´
options(repos = c(CRAN = "https://cran.rstudio.com/"))

# å€‹åˆ¥ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
install.packages("tidyverse", dependencies = TRUE)
install.packages("caret", dependencies = TRUE)
install.packages("randomForest", dependencies = TRUE)
```

### Pythonä»®æƒ³ç’°å¢ƒãŒæœ‰åŠ¹åŒ–ã•ã‚Œãªã„

#### Windows

```cmd
venv\Scripts\activate.bat
```

#### macOS/Linux

```bash
source venv/bin/activate
```

## å‹•ä½œç¢ºèª

### 1. Rã®å‹•ä½œç¢ºèª

```r
# Rã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
library(tidyverse)
library(caret)
library(randomForest)
cat("Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒæˆåŠŸã—ã¾ã—ãŸ\n")
```

### 2. Pythonç’°å¢ƒã®ç¢ºèª

```bash
# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–å¾Œ
python --version
pip list | grep rpy2
pip list | grep fastapi
```

### 3. rpy2ã®å‹•ä½œç¢ºèª

```python
# Pythonã§å®Ÿè¡Œ
import rpy2.robjects as ro
print("rpy2ã®èª­ã¿è¾¼ã¿ãŒæˆåŠŸã—ã¾ã—ãŸ")
print(f"R version: {ro.r('R.version.string')[0]}")

# Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¢ºèª
from rpy2.robjects.packages import importr
base = importr('base')
caret = importr('caret')
print("Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿è¾¼ã¿ãŒæˆåŠŸã—ã¾ã—ãŸ")
```

### 4. FastAPIã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ç¢ºèª

```bash
cd r_api
python predict_api_fastapi.py
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:5000/docs ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã€‚

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ç’°å¢ƒæ§‹ç¯‰å®Œäº†
2. ğŸ”„ Rã§ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ãƒ»ä¿å­˜ï¼ˆ`r_api/save_r_models.R`ã‚’å®Ÿè¡Œï¼‰
3. ğŸ”„ FastAPIã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
4. ğŸ”„ Node.jsã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰FastAPIã‚’å‘¼ã³å‡ºã™

## å‚è€ƒãƒªãƒ³ã‚¯

- [Rå…¬å¼ã‚µã‚¤ãƒˆ](https://www.r-project.org/)
- [rpy2ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rpy2.github.io/)
- [FastAPIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://fastapi.tiangolo.com/)
- [Rtools (Windows)](https://cran.r-project.org/bin/windows/Rtools/)

