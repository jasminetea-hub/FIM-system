# SSH接続手順（macOS版）

さくらのVPSにSSHで接続する方法です。

## 接続情報

- **IPアドレス**: 160.16.92.115
- **ユーザー名**: ubuntu
- **パスワード**: sakura.ubuntu1127

## 方法1: SSH鍵を使用して接続（推奨・安全）

### ステップ1: SSH鍵を生成（まだ生成していない場合）

```bash
# SSH鍵を生成
ssh-keygen -t ed25519 -C "sakura-vps" -f ~/.ssh/sakura_vps_key

# パスフレーズを設定するか、Enterキーでスキップ
```

### ステップ2: 公開鍵の内容を表示

```bash
# 公開鍵の内容を表示
cat ~/.ssh/sakura_vps_key.pub
```

### ステップ3: 公開鍵をVPSに登録

#### オプションA: さくらのコントロールパネルで登録（推奨）

1. さくらのコントロールパネルにログイン
2. VPSの管理画面を開く
3. 「SSH鍵」または「鍵管理」のセクションを開く
4. 表示された公開鍵の内容をコピーして登録

#### オプションB: VNCコンソールで登録

1. さくらのコントロールパネルからVNCコンソールにアクセス
2. VNCコンソールでログイン（ユーザー名: `ubuntu`, パスワード: `sakura.ubuntu1127`）
3. 以下のコマンドを実行：

```bash
# .sshディレクトリを作成
mkdir -p ~/.ssh
chmod 700 ~/.ssh

# 公開鍵を追加（[公開鍵の内容]を実際の公開鍵に置き換え）
echo "[公開鍵の内容]" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
```

### ステップ4: SSH接続

```bash
# 秘密鍵を指定して接続
ssh -i ~/.ssh/sakura_vps_key ubuntu@160.16.92.115
```

### ステップ5: SSH設定ファイルを使用（簡単に接続）

SSH設定ファイルを作成すると、毎回オプションを指定する必要がなくなります：

```bash
# 設定ファイルを編集
nano ~/.ssh/config
```

以下の内容を追加：

```
Host sakura-vps
    HostName 160.16.92.115
    User ubuntu
    IdentityFile ~/.ssh/sakura_vps_key
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

保存後、以下のコマンドで簡単に接続：

```bash
ssh sakura-vps
```

## 方法2: パスワード認証で接続

パスワード認証が有効になっている場合：

```bash
ssh ubuntu@160.16.92.115
```

パスワードを求められたら: `sakura.ubuntu1127`

**注意**: パスワード認証はセキュリティ上推奨されません。可能な限りSSH鍵認証を使用してください。

## 接続確認

接続が成功すると、以下のようなプロンプトが表示されます：

```
ubuntu@ubuntu:~$
```

## よく使うコマンド

### 接続後、現在のディレクトリを確認

```bash
pwd
```

### ホームディレクトリに移動

```bash
cd ~
```

### システム情報を確認

```bash
uname -a
lsb_release -a
```

### 接続を切断

```bash
exit
```

または `Ctrl + D`

## トラブルシューティング

### 接続できない場合

1. **IPアドレスを確認**: `160.16.92.115`
2. **ファイアウォールを確認**: SSHポート（22）が開放されているか
3. **VPSの状態を確認**: さくらのコントロールパネルでVPSが起動しているか確認
4. **ネットワーク接続を確認**: インターネットに接続されているか確認

### パスワード認証が拒否される場合

SSH鍵認証を使用するか、VNCコンソールからパスワード認証を有効化してください。

### SSH鍵のパスが見つからない場合

```bash
# SSH鍵の場所を確認
ls -la ~/.ssh/sakura_vps_key*
```

### 権限エラーが発生する場合

```bash
# SSH鍵の権限を確認・修正
chmod 600 ~/.ssh/sakura_vps_key
chmod 700 ~/.ssh
```

### 接続がタイムアウトする場合

1. ファイアウォールでSSHポート（22）が開放されているか確認
2. さくらのコントロールパネルでVPSの状態を確認
3. IPアドレスが正しいか確認

## 次のステップ

接続が成功したら、以下のドキュメントを参照してデプロイを進めてください：

- `VPSデプロイ実行コマンド.md`
- `docs/GitHub経由デプロイ手順.md`
- `docs/VPS常時稼働デプロイ手順.md`
