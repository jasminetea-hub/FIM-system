# 予測方法の説明

この Web アプリケーションは、**R で学習した機械学習モデルを使用して退院時の FIM データを予測**するシステムです。

## 予測方法: R モデル予測

**R で学習したランダムフォレストモデルを使用**

- **仕組み**: R で学習したランダムフォレストモデルを使用して予測
- **特徴**:
  - 機械学習による予測
  - 高精度な予測が可能
  - R FastAPI サーバーと連携
- **使用ファイル**: `server_r_model.js` + `r_api/predict_api_fastapi.py`

**予測の流れ**:

1. 入力データ（入院時の FIM 値、個人情報）を受け取る
2. Node.js サーバー（`server_r_model.js`）が R FastAPI サーバー（`http://localhost:5000`）に送信
3. R FastAPI サーバーが R モデルで予測を実行
4. 予測結果を Node.js サーバーに返す
5. 予測結果をデータベースに保存
6. フロントエンドに予測結果を返す

## 予測されるデータ

以下の**退院時の FIM データ**が予測されます：

### 運動機能項目（13 項目）

- 食事、整容、清拭、更衣上半身、更衣下半身、トイレ動作、排尿管理、排便管理、ベッド移乗、トイレ移乗、浴槽移乗、歩行、階段

### 認知機能項目（5 項目）

- 理解、表出、社会的交流、問題解決、記憶

### 合計値

- 運動機能合計（13 項目の合計）
- 認知機能合計（5 項目の合計）
- FIM 総合計（18 項目の合計）

## デプロイ方法

### 1. R FastAPI サーバーの起動

```bash
cd r_api
python predict_api_fastapi.py
```

R FastAPI サーバーは `http://localhost:5000` で起動します。

### 2. Node.js サーバーの起動

```bash
npm run server
```

または、PM2 を使用：

```bash
pm2 start ecosystem.r.config.js
```

### 3. R モデルファイルの確認

`r_api/r_models/`ディレクトリに以下の R モデルファイル（`.rds`）が必要です：

- `rf_model_all_FIM.rds` - 総合計予測モデル
- `rf_model_motor_FIM.rds` - 運動機能合計予測モデル
- `rf_model_cog_FIM.rds` - 認知機能合計予測モデル
- 各項目の予測モデル（食事、整容、清拭など）

R モデルファイルが存在しない場合、R でモデルを学習・保存する必要があります：

```r
# Rコンソールで実行
source("r_api/save_r_models.R")
```

## まとめ

- **予測方法**: R で学習したランダムフォレストモデルを使用
- **サーバー**: `server_r_model.js` + R FastAPI サーバー
- **予測内容**: 退院時の FIM データ（運動機能 13 項目、認知機能 5 項目、合計値）
