# システム概要

本システムは、リハビリテーション患者の退院時のFIM（Functional Independence Measure：機能的自立度評価法）値を予測するWebアプリケーションである。入院時の患者情報とFIM値を入力することで、機械学習モデルを用いて退院時のFIM値を予測し、リハビリテーション計画の立案や予後予測に活用することを目的としている。

本システムは、フロントエンド、バックエンド、機械学習APIの3層アーキテクチャで構成されている。フロントエンドはReact 19.2.0とVite 7.2.6を使用したWebアプリケーションであり、ユーザーインターフェースを提供する。バックエンドはNode.jsとExpress 5.2.1で実装され、フロントエンドと機械学習APIの間の仲介役を担う。機械学習APIはPythonのFastAPIで実装され、R言語で学習したランダムフォレストモデルを実行する。各層はHTTP/JSONプロトコルで通信し、フロントエンドはポート5173、バックエンドはポート3001、機械学習APIはポート5000で動作する。

フロントエンドの実装には、UI構築のためのReact 19.2.0、高速な開発サーバーとビルドツールであるVite 7.2.6、ルーティング管理のためのReact Router DOM 7.10.1、データ可視化のためのRecharts 3.5.1が使用されている。バックエンドはNode.jsの実行環境上でExpress 5.2.1フレームワークを使用して実装されている。機械学習APIはPythonで実装され、FastAPIフレームワークを使用している。機械学習モデルはR言語で学習され、rpy2ライブラリを通じてPythonから呼び出される。予測アルゴリズムにはランダムフォレストが採用されている。

システムの主要機能は、入力機能、予測機能、結果表示機能の3つである。入力機能では、ユーザーが個人情報として性別、年齢、BMI（Body Mass Index）、要介護度の有無、発症から入棟までの日数を入力する。さらに、入院時FIM運動機能項目として食事、整容、清拭、更衣上半身、更衣下半身、トイレ動作、排尿管理、排便管理、ベッド移乗、トイレ移乗、浴槽移乗、歩行の12項目を、入院時FIM認知機能項目として理解、表出、社会的交流、問題解決、記憶の5項目を入力する。各FIM項目は1から7の7段階評価で入力される。

予測機能では、入力されたデータを基に、運動機能項目12項目、認知機能項目5項目のそれぞれについて個別のランダムフォレストモデルを使用して予測を実行する。各項目の予測値は0から7の範囲に制限される。また、運動機能合計、認知機能合計、総合得点についても専用のモデルを使用して予測するか、個別予測値の合計として算出する。

結果表示機能では、予測結果をレーダーチャートと合計点テーブルの形式で表示する。レーダーチャートでは、運動機能項目と認知機能項目それぞれについて、入院時値と予測値を比較表示し、視覚的に改善傾向を確認できる。合計点テーブルでは、入院時と予測値の運動機能合計、認知機能合計、総合得点を比較表示する。

予測処理の流れは以下の通りである。まず、ユーザーがフロントエンドのフォームに入力データを入力し、必須項目や数値範囲のバリデーションが行われる。次に、フロントエンドからバックエンドの`POST /api/predict`エンドポイントにJSON形式で入力データが送信される。バックエンドは受け取ったリクエストをR FastAPIサーバーの`POST http://localhost:5000/predict`エンドポイントに転送する。機械学習APIでは、入力データをRのデータフレーム形式に変換し、各項目のランダムフォレストモデルで予測を実行した後、予測結果をJSON形式で返却する。最後に、フロントエンドが予測結果を受け取り、レーダーチャートとテーブルで入院時値と予測値を比較表示する。

APIのリクエスト形式は、性別、年齢、BMI、要介護度、発症からの日数、運動機能項目の値、認知機能項目の値を含むJSONオブジェクトである。レスポンス形式は、運動機能項目の予測値配列、認知機能項目の予測値配列、運動機能合計、認知機能合計、総合得点を含むJSONオブジェクトである。

本システムでは、合計19個のランダムフォレストモデルを使用する。総合予測モデル1個、運動機能合計モデル1個、認知機能合計モデル1個、運動機能項目モデル12個、認知機能項目モデル5個である。これらのモデルは、R言語の`caret`パッケージを使用して学習され、`.rds`形式（Rのシリアライズ形式）で保存される。予測範囲はFIMスコアの0から7の範囲に制限される。アプリケーション起動時にすべてのモデルをメモリに読み込むことで、予測リクエストごとにモデルを再読み込みする必要がなく、高速な予測が可能となっている。

セキュリティ対策として、クロスオリジンリソース共有（CORS）の適切な設定、フロントエンドとバックエンドの両方での入力データの検証、適切なエラーメッセージとステータスコードの返却が実装されている。パフォーマンスの最適化として、起動時のモデルの事前読み込みによる予測時のオーバーヘッドの削減、Node.jsの非同期処理による複数リクエストの効率的な処理が行われている。通常、予測処理は数秒以内に完了する。

開発環境では、フロントエンドはVite開発サーバー（`npm run dev`）、バックエンドはNode.jsサーバー（`npm run server`）、機械学習APIはFastAPIサーバー（`python predict_api_fastapi.py`）でそれぞれ起動する。本番環境では、フロントエンドを`npm run build`でビルドし、Node.jsサーバーが静的ファイルとAPIの両方を提供する。プロセス管理にはPM2を使用し、VPS（さくらのVPSなど）へのデプロイに対応している。

本システムの特徴として、ランダムフォレストモデルによる高精度な予測、各FIM項目ごとに最適化されたモデルを使用した項目ごとの個別予測、レーダーチャートによる直感的な結果表示が挙げられる。これらの特徴により、退院時のFIM値を予測することで適切なリハビリテーション計画の立案が可能となり、機械学習モデルによる客観的な予測により予後予測の精度が向上する。また、直感的なWebインターフェースにより、医療従事者が容易に利用できる。

今後の拡張可能性として、新しいデータが蓄積された際のモデルの再学習機能、より高度な機械学習アルゴリズムの導入による予測精度の向上、より多くの変数を考慮した予測モデルの構築、予測結果の詳細レポート生成機能、複数のユーザーによる利用を想定した認証機能などが考えられる。
