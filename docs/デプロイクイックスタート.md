# デプロイクイックスタートガイド

さくらのインターネットへのデプロイを最短で完了させるためのガイドです。

## デプロイ方法の選択

- **GitHub経由（推奨）**: `git clone`でデプロイ、`git pull`で更新 → [GitHub経由デプロイ手順](GitHub経由デプロイ手順.md)
- **FTP/SFTP経由**: ファイルを直接アップロード → このガイド

## 前提条件チェック

- [ ] さくらのレンタルサーバー（スタンダードプラン以上）またはVPS
- [ ] SSHアクセス権限
- [ ] Node.jsが利用可能（`node --version`で確認）

## 5分でデプロイ（距離ベース予測のみ）

### ステップ1: ローカルでビルド（1分）

```bash
npm install
npm run build
```

### ステップ2: ファイルをアップロード（2分）

FTP/SFTPクライアント（FileZilla、WinSCPなど）を使用して、以下をサーバーにアップロード：

**必須ファイル:**
- `server.js`
- `package.json`
- `package-lock.json`
- `dist/` （ディレクトリごと）
- `public/` （ディレクトリごと）
- `scripts/` （ディレクトリごと）
- `ecosystem.config.js` （PM2設定ファイル）

**オプション:**
- `database.db` （既存のデータベースがある場合）
- `.htaccess.example` （`.htaccess`としてアップロード）

### ステップ3: サーバーでセットアップ（2分）

SSHでサーバーに接続：

```bash
# 1. アップロードしたディレクトリに移動
cd /home/[ユーザー名]/[ドメイン名]/

# 2. 依存関係をインストール
npm install --production

# 3. データベースを初期化（初回のみ）
npm run init-db

# 4. PM2をインストール
npm install -g pm2

# 5. ログディレクトリを作成
mkdir -p logs

# 6. アプリケーションを起動
pm2 start ecosystem.config.js

# 7. 自動起動を設定
pm2 startup
pm2 save

# 8. ステータス確認
pm2 status
```

### ステップ4: リバースプロキシの設定

`.htaccess.example`を`.htaccess`としてアップロード済みの場合、設定は完了しています。
Apacheの`mod_proxy`と`mod_rewrite`が有効になっている必要があります。

### ステップ5: 動作確認

ブラウザで `http://[あなたのドメイン]/` にアクセスして動作確認。

---

## トラブルシューティング

### ポート3001が使用できない

`.htaccess`ファイルでリバースプロキシが設定されているか確認してください。

### PM2が起動しない

```bash
# ログを確認
pm2 logs fim-prediction

# エラーの詳細を確認
pm2 describe fim-prediction
```

### 静的ファイルが表示されない

`dist/`ディレクトリが正しくアップロードされているか確認：

```bash
ls -la dist/
```

### データベースエラー

データベースファイルの権限を確認：

```bash
chmod 664 database.db
chmod 755 .
```

---

## 次のステップ

詳細な設定やRモデルを使用する場合は、`docs/さくらのインターネットデプロイ手順.md`を参照してください。

