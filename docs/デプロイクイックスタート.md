# デプロイクイックスタートガイド

さくらのインターネットへのデプロイを最短で完了させるためのガイドです。

## デプロイ方法の選択

- **GitHub 経由（推奨）**: `git clone`でデプロイ、`git pull`で更新 → [GitHub 経由デプロイ手順](GitHub経由デプロイ手順.md)
- **FTP/SFTP 経由**: ファイルを直接アップロード → このガイド

## 前提条件チェック

- [ ] さくらのレンタルサーバー（スタンダードプラン以上）または VPS
- [ ] SSH アクセス権限
- [ ] Node.js が利用可能（`node --version`で確認）

## 5 分でデプロイ（距離ベース予測のみ）

### ステップ 1: ローカルでビルド（1 分）

```bash
npm install
npm run build
```

### ステップ 2: ファイルをアップロード（2 分）

FTP/SFTP クライアント（FileZilla、WinSCP など）を使用して、以下をサーバーにアップロード：

**必須ファイル:**

- `server.js`
- `package.json`
- `package-lock.json`
- `dist/` （ディレクトリごと）
- `public/` （ディレクトリごと）
- `scripts/` （ディレクトリごと）
- `ecosystem.config.js` （PM2 設定ファイル）

**オプション:**

- `database.db` （既存のデータベースがある場合）
- `.htaccess.example` （`.htaccess`としてアップロード）

### ステップ 3: サーバーでセットアップ（2 分）

SSH でサーバーに接続：

```bash
# 1. アップロードしたディレクトリに移動
cd /home/[ユーザー名]/[ドメイン名]/

# 2. 依存関係をインストール
npm install --production

# 3. データベースを初期化（初回のみ）
npm run init-db

# 4. PM2をインストール
npm install -g pm2

# 5. ログディレクトリを作成
mkdir -p logs

# 6. アプリケーションを起動
pm2 start ecosystem.config.js

# 7. 自動起動を設定
pm2 startup
pm2 save

# 8. ステータス確認
pm2 status
```

### ステップ 4: リバースプロキシの設定

`.htaccess.example`を`.htaccess`としてアップロード済みの場合、設定は完了しています。
Apache の`mod_proxy`と`mod_rewrite`が有効になっている必要があります。

### ステップ 5: 動作確認

ブラウザで `http://[あなたのドメイン]/` にアクセスして動作確認。

---

## トラブルシューティング

### ポート 3001 が使用できない

`.htaccess`ファイルでリバースプロキシが設定されているか確認してください。

### PM2 が起動しない

```bash
# ログを確認
pm2 logs fim-prediction

# エラーの詳細を確認
pm2 describe fim-prediction
```

### 静的ファイルが表示されない

`dist/`ディレクトリが正しくアップロードされているか確認：

```bash
ls -la dist/
```

### データベースエラー

データベースファイルの権限を確認：

```bash
chmod 664 database.db
chmod 755 .
```

---

## 次のステップ

詳細な設定や R モデルを使用する場合は、`docs/さくらのインターネットデプロイ手順.md`を参照してください。
