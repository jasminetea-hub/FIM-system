# Rモデルを使用した予測システム - セットアップ手順

## 完全なセットアップ手順

### ステップ1: 依存関係のインストール

#### Node.js依存関係
```bash
npm install
```

#### Python依存関係
```bash
cd r_api
pip install -r requirements.txt
```

### ステップ2: Rのセットアップ

1. **Rのインストール**
   - https://cran.r-project.org/ からRをインストール

2. **Rパッケージのインストール**
   ```r
   # Rコンソールで実行
   source("r_api/install_r_packages.R")
   ```

3. **Rモデルの学習・保存**
   ```r
   # Rコンソールで実行
   source("r_api/save_r_models.R")
   ```
   
   これにより、`r_models/`ディレクトリに`.rds`形式のモデルファイルが保存されます。

### ステップ3: データベースの初期化

```bash
npm run init-db
```

### ステップ4: サーバーの起動

#### ターミナル1: R FastAPIサーバー
```bash
cd r_api
python predict_api_fastapi.py
```

#### ターミナル2: Node.jsサーバー
```bash
npm run server:r
```

#### ターミナル3: フロントエンド
```bash
npm run dev
```

### ステップ5: 動作確認

1. ブラウザで `http://localhost:5173` にアクセス
2. フォームに入力して予測を実行
3. 予測結果が表示されることを確認
4. 予測履歴を確認：
   ```bash
   npm run view-predictions
   ```

## 動作確認チェックリスト

- [ ] R FastAPIサーバーが起動している（`http://localhost:5000/health`）
- [ ] Node.jsサーバーが起動している（`http://localhost:3001`）
- [ ] フロントエンドが起動している（`http://localhost:5173`）
- [ ] Rモデルが読み込まれている（R FastAPIのログを確認）
- [ ] 予測が正常に動作する
- [ ] 予測結果がデータベースに保存される

## トラブルシューティング

### R FastAPIが起動しない

1. Rがインストールされているか確認
2. rpy2がインストールされているか確認
3. Rモデルファイルが存在するか確認

### 予測が失敗する

1. R FastAPIのログを確認
2. 列名の不一致エラーが出ていないか確認
3. 入力データの形式が正しいか確認

詳細は `docs/Rモデル使用ガイド.md` を参照してください。

