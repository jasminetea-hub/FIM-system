# 予測動作の確認

## 現在の実装状況

**`server_r_model.js`の動作を確認した結果：**

### ✅ Rモデル予測のみで動作

現在の実装では、**Rモデル予測のみ**でデータが出力されます。

### 予測の流れ

1. **R FastAPIが利用可能な場合**
   - R FastAPIサーバー（`http://localhost:5000`）に予測リクエストを送信
   - Rモデルで予測を実行
   - 予測結果を返す
   - 予測結果をデータベースに保存

2. **R FastAPIが利用できない場合**
   - **503エラーを返す**
   - 予測は実行されない
   - フォールバック処理はない

### コードの確認

`server_r_model.js`の`/api/predict`エンドポイント：

```javascript
// R FastAPIが利用可能な場合
if (rAPIAvailable) {
  // R FastAPIに予測リクエストを送信
  const response = await axios.post(`${R_API_URL}/predict`, inputData);
  prediction = response.data;
} else {
  // R FastAPIが利用できない場合はエラーを返す
  return res.status(503).json({ 
    error: 'R FastAPIが利用できません。R FastAPIサーバーを起動してください。',
    hint: 'python r_api/predict_api_fastapi.py'
  });
}
```

### 重要なポイント

- ✅ **Rモデル予測のみ**でデータが出力される
- ❌ R FastAPIが利用できない場合は**エラー**になる

### データベースの使用

データベースは以下の目的でのみ使用されます：

1. **予測履歴の保存** - Rモデルで予測した結果を保存
2. **予測履歴の取得** - `/api/predictions`エンドポイント
3. **データ確認用** - `/api/data`エンドポイント（開発用、予測には使用されない）

### まとめ

**はい、Rモデル予測のみでデータが出力されます。**

- R FastAPIが起動している必要がある
- Rモデルファイル（.rds）が必要
- R FastAPIが利用できない場合は予測できない（エラーになる）

## 動作確認方法

### 1. R FastAPIが起動しているか確認

```bash
curl http://localhost:5000/health
```

期待されるレスポンス：
```json
{
  "status": "ok",
  "models_loaded": 20,
  "available_models": [...]
}
```

### 2. 予測APIをテスト

```bash
curl -X POST http://localhost:3001/api/predict \
  -H "Content-Type: application/json" \
  -d '{
    "gender": "male",
    "age": 65,
    "bmi": 22.5,
    "careLevel": "no",
    "daysFromOnset": 30,
    "motionValues": {"食事": 5, "整容": 4, ...},
    "cognitiveValues": {"理解": 5, "表出": 4, ...}
  }'
```

### 3. R FastAPIが停止している場合の動作確認

R FastAPIを停止してから予測リクエストを送信すると、503エラーが返されます。

