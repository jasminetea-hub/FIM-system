# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹•ä½œèª¬æ˜Ž

## ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€**Rã§å­¦ç¿’ã—ãŸãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«**ã‚’ä½¿ç”¨ã—ã¦é€€é™¢æ™‚ã®FIMãƒ‡ãƒ¼ã‚¿ã‚’äºˆæ¸¬ã—ã¾ã™ã€‚

## ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶   â”‚ â”€â”€â”€â”€â”€â”€> â”‚  React App   â”‚ â”€â”€â”€â”€â”€â”€> â”‚ Node.js API â”‚
â”‚  (ãƒ¦ãƒ¼ã‚¶ãƒ¼) â”‚ <â”€â”€â”€â”€â”€â”€ â”‚  (ãƒ•ãƒ­ãƒ³ãƒˆ)  â”‚ <â”€â”€â”€â”€â”€â”€ â”‚(server_r_   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  model.js)  â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚ R FastAPI   â”‚
                                                  â”‚ (ãƒãƒ¼ãƒˆ5000) â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚ Rãƒ¢ãƒ‡ãƒ«     â”‚
                                                  â”‚ (.rdsãƒ•ã‚¡ã‚¤ãƒ«)â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â–¼
                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                  â”‚ SQLite DB   â”‚
                                                  â”‚ (äºˆæ¸¬å±¥æ­´)  â”‚
                                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‹•ä½œã®æµã‚Œ

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰
```bash
npm run dev
```
- Viteé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ï¼ˆé€šå¸¸ã¯ `http://localhost:5173`ï¼‰
- Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆNode.jsï¼‰
```bash
npm run server
```
- Expressã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ï¼ˆ`http://localhost:3001`ï¼‰
- SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æŽ¥ç¶š

### 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›

**å…¥åŠ›é …ç›®ï¼š**

1. **å€‹äººæƒ…å ±**
   - æ€§åˆ¥ï¼ˆç”·æ€§/å¥³æ€§ï¼‰
   - å¹´é½¢
   - BMI
   - è¦ä»‹è­·åº¦ã®æœ‰ç„¡
   - ç™ºç—‡ã‹ã‚‰ã®æ—¥æ•°

2. **å…¥é™¢æ™‚FIMé‹å‹•æ©Ÿèƒ½é …ç›®ï¼ˆ12é …ç›®ï¼‰**
   - é£Ÿäº‹ã€æ•´å®¹ã€æ¸…æ‹­ã€æ›´è¡£ä¸ŠåŠèº«ã€æ›´è¡£ä¸‹åŠèº«
   - ãƒˆã‚¤ãƒ¬å‹•ä½œã€æŽ’å°¿ç®¡ç†ã€æŽ’ä¾¿ç®¡ç†
   - ãƒ™ãƒƒãƒ‰ç§»ä¹—ã€ãƒˆã‚¤ãƒ¬ç§»ä¹—ã€æµ´æ§½ç§»ä¹—ã€æ­©è¡Œ

3. **å…¥é™¢æ™‚FIMèªçŸ¥æ©Ÿèƒ½é …ç›®ï¼ˆ5é …ç›®ï¼‰**
   - ç†è§£ã€è¡¨å‡ºã€ç¤¾ä¼šçš„äº¤æµã€å•é¡Œè§£æ±ºã€è¨˜æ†¶

### 3. äºˆæ¸¬APIã®å‘¼ã³å‡ºã—

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ`src/pages/FormPage.jsx`ï¼‰**
```javascript
// APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: /api/predict
const response = await fetch('/api/predict', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify(inputData)
});
```

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`server_r_model.js`ï¼‰ã®å‡¦ç†ï¼š**

#### ã‚¹ãƒ†ãƒƒãƒ—1: R FastAPIã‚µãƒ¼ãƒãƒ¼ã«äºˆæ¸¬ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡

```javascript
// R FastAPIã‚µãƒ¼ãƒãƒ¼ï¼ˆhttp://localhost:5000ï¼‰ã«é€ä¿¡
const response = await axios.post(
  'http://localhost:5000/predict',
  inputData,
  { timeout: 10000 }
);
```

#### ã‚¹ãƒ†ãƒƒãƒ—2: R FastAPIã‚µãƒ¼ãƒãƒ¼ã§ã®äºˆæ¸¬å®Ÿè¡Œ

R FastAPIã‚µãƒ¼ãƒãƒ¼ï¼ˆ`r_api/predict_api_fastapi.py`ï¼‰ãŒä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

1. å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’Rã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ å½¢å¼ã«å¤‰æ›
2. å„é …ç›®ã®Rãƒ¢ãƒ‡ãƒ«ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆï¼‰ã§äºˆæ¸¬ã‚’å®Ÿè¡Œ
   - é‹å‹•æ©Ÿèƒ½é …ç›®ï¼ˆ12é …ç›®ï¼‰: é£Ÿäº‹ã€æ•´å®¹ã€æ¸…æ‹­ã€æ›´è¡£ä¸ŠåŠèº«ã€æ›´è¡£ä¸‹åŠèº«ã€ãƒˆã‚¤ãƒ¬å‹•ä½œã€æŽ’å°¿ç®¡ç†ã€æŽ’ä¾¿ç®¡ç†ã€ãƒ™ãƒƒãƒ‰ç§»ä¹—ã€ãƒˆã‚¤ãƒ¬ç§»ä¹—ã€æµ´æ§½ç§»ä¹—ã€æ­©è¡Œ
   - èªçŸ¥æ©Ÿèƒ½é …ç›®ï¼ˆ5é …ç›®ï¼‰: ç†è§£ã€è¡¨å‡ºã€ç¤¾ä¼šçš„äº¤æµã€å•é¡Œè§£æ±ºã€è¨˜æ†¶
   - åˆè¨ˆå€¤: é‹å‹•æ©Ÿèƒ½åˆè¨ˆã€èªçŸ¥æ©Ÿèƒ½åˆè¨ˆã€ç·åˆè¨ˆ
3. äºˆæ¸¬çµæžœã‚’è¿”ã™

#### ã‚¹ãƒ†ãƒƒãƒ—3: äºˆæ¸¬çµæžœã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜

```javascript
// äºˆæ¸¬å±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
INSERT INTO prediction_history (
  input_gender, input_age, input_bmi, ...
  predicted_motion, predicted_cognitive, ...
) VALUES (...)
```

#### ã‚¹ãƒ†ãƒƒãƒ—4: äºˆæ¸¬çµæžœã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«è¿”ã™

### 4. äºˆæ¸¬çµæžœã®è¡¨ç¤º

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ï¼š**
```json
{
  "motion": [5, 4, 3, ...],      // é‹å‹•æ©Ÿèƒ½é …ç›®ã®äºˆæ¸¬å€¤ï¼ˆ13é …ç›®ï¼‰
  "cognitive": [6, 6, 5, ...],  // èªçŸ¥æ©Ÿèƒ½é …ç›®ã®äºˆæ¸¬å€¤ï¼ˆ5é …ç›®ï¼‰
  "motionTotal": 45,             // é‹å‹•æ©Ÿèƒ½åˆè¨ˆ
  "cognitiveTotal": 28,         // èªçŸ¥æ©Ÿèƒ½åˆè¨ˆ
  "total": 73                    // ç·åˆå¾—ç‚¹
}
```

**çµæžœãƒšãƒ¼ã‚¸ï¼ˆ`src/pages/ResultPage.jsx`ï¼‰ã§è¡¨ç¤ºï¼š**

1. **ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ**
   - é‹å‹•æ©Ÿèƒ½é …ç›®ã®å…¥é™¢æ™‚å€¤ vs äºˆæ¸¬å€¤
   - èªçŸ¥æ©Ÿèƒ½é …ç›®ã®å…¥é™¢æ™‚å€¤ vs äºˆæ¸¬å€¤
   - Rechartsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨

2. **åˆè¨ˆç‚¹ãƒ†ãƒ¼ãƒ–ãƒ«**
   - å…¥é™¢æ™‚ã¨äºˆæ¸¬å€¤ã®æ¯”è¼ƒ
   - é‹å‹•æ©Ÿèƒ½åˆè¨ˆã€èªçŸ¥æ©Ÿèƒ½åˆè¨ˆã€ç·åˆå¾—ç‚¹

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ 

**ãƒ†ãƒ¼ãƒ–ãƒ«åï¼š** `patient_data`

**ã‚«ãƒ©ãƒ ï¼š**
- `id` - ä¸»ã‚­ãƒ¼
- `gender` - æ€§åˆ¥ï¼ˆ0: ç”·æ€§ã€1: å¥³æ€§ï¼‰
- `age` - å¹´é½¢
- `bmi` - BMI
- `care_level` - è¦ä»‹è­·åº¦ï¼ˆ0: ç„¡ã€1: æœ‰ï¼‰
- `days_from_onset` - ç™ºç—‡ã‹ã‚‰ã®æ—¥æ•°
- `admission_motion` - å…¥é™¢æ™‚FIMé‹å‹•æ©Ÿèƒ½é …ç›®ï¼ˆJSONé…åˆ—ï¼‰
- `admission_cognitive` - å…¥é™¢æ™‚FIMèªçŸ¥æ©Ÿèƒ½é …ç›®ï¼ˆJSONé…åˆ—ï¼‰
- `admission_motion_total` - å…¥é™¢æ™‚é‹å‹•æ©Ÿèƒ½åˆè¨ˆ
- `admission_cognitive_total` - å…¥é™¢æ™‚èªçŸ¥æ©Ÿèƒ½åˆè¨ˆ
- `admission_total` - å…¥é™¢æ™‚ç·åˆå¾—ç‚¹
- `discharge_motion` - é€€é™¢æ™‚FIMé‹å‹•æ©Ÿèƒ½é …ç›®ï¼ˆJSONé…åˆ—ï¼‰
- `discharge_cognitive` - é€€é™¢æ™‚FIMèªçŸ¥æ©Ÿèƒ½é …ç›®ï¼ˆJSONé…åˆ—ï¼‰
- `discharge_motion_total` - é€€é™¢æ™‚é‹å‹•æ©Ÿèƒ½åˆè¨ˆ
- `discharge_cognitive_total` - é€€é™¢æ™‚èªçŸ¥æ©Ÿèƒ½åˆè¨ˆ
- `discharge_total` - é€€é™¢æ™‚ç·åˆå¾—ç‚¹

## äºˆæ¸¬ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®ç‰¹å¾´

### âœ… ãƒ¡ãƒªãƒƒãƒˆ
- ãƒ©ãƒ³ãƒ€ãƒ ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã‚‹é«˜ç²¾åº¦ãªäºˆæ¸¬
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚‚å¯¾å¿œå¯èƒ½
- æ©Ÿæ¢°å­¦ç¿’ã«ã‚ˆã‚‹æ±ŽåŒ–æ€§èƒ½
- å„é …ç›®ã”ã¨ã«æœ€é©åŒ–ã•ã‚ŒãŸãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨

### ðŸ“‹ å¿…è¦ãªç’°å¢ƒ
- Rï¼ˆRè¨€èªžã®å®Ÿè¡Œç’°å¢ƒï¼‰
- rpy2ï¼ˆPythonã‹ã‚‰Rã‚’å‘¼ã³å‡ºã™ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
- Rãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆcaret, randomForest, rpartï¼‰
- Rãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.rdsãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

## APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

### POST /api/predict

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼š**
```json
{
  "gender": "male",
  "age": 65,
  "bmi": 23.5,
  "careLevel": "no",
  "daysFromOnset": 30,
  "motionValues": {
    "é£Ÿäº‹": 5,
    "æ•´å®¹": 4,
    ...
  },
  "cognitiveValues": {
    "ç†è§£": 6,
    "è¡¨å‡º": 6,
    ...
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š**
```json
{
  "motion": [5, 4, 3, ...],
  "cognitive": [6, 6, 5, ...],
  "motionTotal": 45,
  "cognitiveTotal": 28,
  "total": 73
}
```

### GET /api/data

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªï¼ˆé–‹ç™ºç”¨ï¼‰

### GET /api/stats

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®çµ±è¨ˆæƒ…å ±ã‚’å–å¾—

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm install
   ```

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–**
   ```bash
   npm run init-db
   ```

3. **ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•**
   ```bash
   # R FastAPIã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«1ï¼‰
   cd r_api
   python predict_api_fastapi.py
   
   # Node.jsã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«2ï¼‰
   npm run server
   
   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚¿ãƒ¼ãƒŸãƒŠãƒ«3ã€é–‹ç™ºæ™‚ã®ã¿ï¼‰
   npm run dev
   ```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### APIã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆ

1. ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒæ­£ã—ãåˆæœŸåŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   ```bash
   npm run view-db
   ```
3. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### äºˆæ¸¬çµæžœãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ

1. å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ã„å½¢å¼ã‹ç¢ºèª
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«é¡žä¼¼ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã§APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª

