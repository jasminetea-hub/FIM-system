# Rモデルデプロイチェックリスト

## デプロイ前の確認

- [ ] VPSにSSH接続できる
- [ ] GitHubリポジトリがプッシュ済み
- [ ] Rモデルファイル（.rds）が存在する

## システムセットアップ

- [ ] システムが更新されている（`sudo apt update && sudo apt upgrade -y`）
- [ ] Node.js 18.xがインストールされている
- [ ] Python 3がインストールされている
- [ ] Rがインストールされている
- [ ] Rパッケージ（caret, randomForest, rpart）がインストールされている
- [ ] rpy2がインストールされている
- [ ] PM2がインストールされている
- [ ] ファイアウォールが設定されている（ポート22, 3001, 5000）

## アプリケーションセットアップ

- [ ] GitHubリポジトリがクローンされている
- [ ] Node.js依存関係がインストールされている
- [ ] Python依存関係がインストールされている（venv）
- [ ] フロントエンドがビルドされている
- [ ] データベースが初期化されている
- [ ] ログディレクトリが作成されている
- [ ] 環境変数ファイル（.env）が設定されている

## Rモデルファイル

- [ ] `r_api/r_models/rf_model_all_FIM.rds` が存在する
- [ ] `r_api/r_models/rf_model_motor_FIM.rds` が存在する
- [ ] `r_api/r_models/rf_model_cog_FIM.rds` が存在する
- [ ] 各項目のモデルファイルが存在する

## サーバー起動

- [ ] R FastAPIサーバーが起動している（ポート5000）
- [ ] Node.jsサーバー（server_r_model.js）が起動している（ポート3001）
- [ ] PM2の自動起動が設定されている

## 動作確認

- [ ] R FastAPIのヘルスチェックが成功（`curl http://localhost:5000/health`）
- [ ] Node.jsサーバーのAPIが動作（`curl http://localhost:3001/api/stats`）
- [ ] ブラウザでアプリケーションにアクセスできる
- [ ] 予測機能が動作する

## セキュリティ

- [ ] ファイアウォールが有効になっている
- [ ] 環境変数ファイルの権限が適切（600）
- [ ] ログローテーションが設定されている

## トラブルシューティング

問題が発生した場合：

1. **R FastAPIが起動しない**
   - Rがインストールされているか確認
   - rpy2がインストールされているか確認
   - Rモデルファイルが存在するか確認

2. **Node.jsサーバーがR FastAPIに接続できない**
   - R FastAPIが起動しているか確認
   - 環境変数R_API_URLが正しいか確認
   - ポート5000が開放されているか確認

3. **予測が失敗する**
   - R FastAPIのログを確認
   - Node.jsサーバーのログを確認
   - Rモデルファイルが正しく読み込まれているか確認

