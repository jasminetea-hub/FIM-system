# R モデルデプロイチェックリスト

## デプロイ前の確認

- [ ] VPS に SSH 接続できる
- [ ] GitHub リポジトリがプッシュ済み
- [ ] R モデルファイル（.rds）が存在する

## システムセットアップ

- [ ] システムが更新されている（`sudo apt update && sudo apt upgrade -y`）
- [ ] Node.js 18.x がインストールされている
- [ ] Python 3 がインストールされている
- [ ] R がインストールされている
- [ ] R パッケージ（caret, randomForest, rpart）がインストールされている
- [ ] rpy2 がインストールされている
- [ ] PM2 がインストールされている
- [ ] ファイアウォールが設定されている（ポート 22, 3001, 5000）

## アプリケーションセットアップ

- [ ] GitHub リポジトリがクローンされている
- [ ] Node.js 依存関係がインストールされている
- [ ] Python 依存関係がインストールされている（venv）
- [ ] フロントエンドがビルドされている
- [ ] データベースが初期化されている
- [ ] ログディレクトリが作成されている
- [ ] 環境変数ファイル（.env）が設定されている

## R モデルファイル

- [ ] `r_api/r_models/rf_model_all_FIM.rds` が存在する
- [ ] `r_api/r_models/rf_model_motor_FIM.rds` が存在する
- [ ] `r_api/r_models/rf_model_cog_FIM.rds` が存在する
- [ ] 各項目のモデルファイルが存在する

## サーバー起動

- [ ] R FastAPI サーバーが起動している（ポート 5000）
- [ ] Node.js サーバー（server_r_model.js）が起動している（ポート 3001）
- [ ] PM2 の自動起動が設定されている

## 動作確認

- [ ] R FastAPI のヘルスチェックが成功（`curl http://localhost:5000/health`）
- [ ] Node.js サーバーの API が動作（`curl http://localhost:3001/api/stats`）
- [ ] ブラウザでアプリケーションにアクセスできる
- [ ] 予測機能が動作する

## セキュリティ

- [ ] ファイアウォールが有効になっている
- [ ] 環境変数ファイルの権限が適切（600）
- [ ] ログローテーションが設定されている

## トラブルシューティング

問題が発生した場合：

1. **R FastAPI が起動しない**

   - R がインストールされているか確認
   - rpy2 がインストールされているか確認
   - R モデルファイルが存在するか確認

2. **Node.js サーバーが R FastAPI に接続できない**

   - R FastAPI が起動しているか確認
   - 環境変数 R_API_URL が正しいか確認
   - ポート 5000 が開放されているか確認

3. **予測が失敗する**
   - R FastAPI のログを確認
   - Node.js サーバーのログを確認
   - R モデルファイルが正しく読み込まれているか確認
